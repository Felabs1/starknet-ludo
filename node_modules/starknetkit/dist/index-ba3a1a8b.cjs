"use strict";var U=Object.defineProperty;var Q=(e,t,i)=>t in e?U(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var h=(e,t,i)=>(Q(e,typeof t!="symbol"?t+"":t,i),i);const j=require("starknet"),c=require("./connector-14f8958c.cjs");var Y=Object.defineProperty,b=(e,t,i)=>t in e?Y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,E=(e,t,i)=>(b(e,typeof t!="symbol"?t+"":t,i),i),L=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},o=(e,t,i)=>(L(e,t,"read from private field"),i?i.call(e):t.get(e)),N=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},z=(e,t,i,M)=>(L(e,t,"write to private field"),M?M.call(e,i):t.set(e,i),i),u=(e,t,i)=>(L(e,t,"access private method"),i);const f=[{id:"argentX",name:"Argent X",icon:"data:image/svg+xml;base64,Cjxzdmcgd2lkdGg9IjQwIiBoZWlnaHQ9IjM2IiB2aWV3Qm94PSIwIDAgNDAgMzYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik0yNC43NTgyIC0zLjk3MzY0ZS0wN0gxNC42MjM4QzE0LjI4NTEgLTMuOTczNjRlLTA3IDE0LjAxMzggMC4yODExNzggMTQuMDA2NCAwLjYzMDY4M0MxMy44MDE3IDEwLjQ1NDkgOC44MjIzNCAxOS43NzkyIDAuMjUxODkzIDI2LjM4MzdDLTAuMDIwMjA0NiAyNi41OTMzIC0wLjA4MjE5NDYgMjYuOTg3MiAwLjExNjczNCAyNy4yNzA5TDYuMDQ2MjMgMzUuNzM0QzYuMjQ3OTYgMzYuMDIyIDYuNjQwOTkgMzYuMDg3IDYuOTE3NjYgMzUuODc1NEMxMi4yNzY1IDMxLjc3MjggMTYuNTg2OSAyNi44MjM2IDE5LjY5MSAyMS4zMzhDMjIuNzk1MSAyNi44MjM2IDI3LjEwNTcgMzEuNzcyOCAzMi40NjQ2IDM1Ljg3NTRDMzIuNzQxIDM2LjA4NyAzMy4xMzQxIDM2LjAyMiAzMy4zMzYxIDM1LjczNEwzOS4yNjU2IDI3LjI3MDlDMzkuNDY0MiAyNi45ODcyIDM5LjQwMjIgMjYuNTkzMyAzOS4xMzA0IDI2LjM4MzdDMzAuNTU5NyAxOS43NzkyIDI1LjU4MDQgMTAuNDU0OSAyNS4zNzU5IDAuNjMwNjgzQzI1LjM2ODUgMC4yODExNzggMjUuMDk2OSAtMy45NzM2NGUtMDcgMjQuNzU4MiAtMy45NzM2NGUtMDdaIiBmaWxsPSIjRkY4NzVCIi8+Cjwvc3ZnPgo=",downloads:{chrome:"https://chrome.google.com/webstore/detail/argent-x-starknet-wallet/dlcobpjiigpikoobohmabehhmhfoodbb",firefox:"https://addons.mozilla.org/en-US/firefox/addon/argent-x"}},{id:"braavos",name:"Braavos",icon:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgICA8cGF0aAogICAgICAgIGQ9Ik02Mi43MDUgMTMuOTExNkM2Mi44MzU5IDE0LjEzMzMgNjIuNjYyMSAxNC40MDcgNjIuNDAzOSAxNC40MDdDNTcuMTgwNyAxNC40MDcgNTIuOTM0OCAxOC41NDI3IDUyLjgzNTEgMjMuNjgxN0M1MS4wNDY1IDIzLjM0NzcgNDkuMTkzMyAyMy4zMjI2IDQ3LjM2MjYgMjMuNjMxMUM0Ny4yMzYxIDE4LjUxNTYgNDMuMDAwOSAxNC40MDcgMzcuNzk0OCAxNC40MDdDMzcuNTM2NSAxNC40MDcgMzcuMzYyNSAxNC4xMzMxIDM3LjQ5MzUgMTMuOTExMkM0MC4wMjE3IDkuNjI4MDkgNDQuNzIwNCA2Ljc1IDUwLjA5OTEgNi43NUM1NS40NzgxIDYuNzUgNjAuMTc2OSA5LjYyODI2IDYyLjcwNSAxMy45MTE2WiIKICAgICAgICBmaWxsPSJ1cmwoI3BhaW50MF9saW5lYXJfMzcyXzQwMjU5KSIgLz4KICAgIDxwYXRoCiAgICAgICAgZD0iTTc4Ljc2MDYgNDUuODcxOEM4MC4yNzI1IDQ2LjMyOTcgODEuNzAyNSA0NS4wMDU1IDgxLjE3MTQgNDMuNTIyMkM3Ni40MTM3IDMwLjIzMzQgNjEuMzkxMSAyNC44MDM5IDUwLjAyNzcgMjQuODAzOUMzOC42NDQyIDI0LjgwMzkgMjMuMjg2OCAzMC40MDcgMTguODc1NCA0My41OTEyQzE4LjM4MjQgNDUuMDY0NSAxOS44MDgzIDQ2LjM0NDYgMjEuMjk3OCA0NS44ODgxTDQ4Ljg3MiAzNy40MzgxQzQ5LjUzMzEgMzcuMjM1NSA1MC4yMzk5IDM3LjIzNDQgNTAuOTAxNyAzNy40MzQ4TDc4Ljc2MDYgNDUuODcxOFoiCiAgICAgICAgZmlsbD0idXJsKCNwYWludDFfbGluZWFyXzM3Ml80MDI1OSkiIC8+CiAgICA8cGF0aAogICAgICAgIGQ9Ik0xOC44MTMyIDQ4LjE3MDdMNDguODkzNSAzOS4wNDcyQzQ5LjU1MDYgMzguODQ3OCA1MC4yNTI0IDM4Ljg0NzMgNTAuOTA5OCAzOS4wNDU2TDgxLjE3ODEgNDguMTc1MkM4My42OTEyIDQ4LjkzMzIgODUuNDExIDUxLjI0ODMgODUuNDExIDUzLjg3MzVWODEuMjIzM0M4NS4yOTQ0IDg3Ljg5OTEgNzkuMjk3NyA5My4yNSA3Mi42MjQ1IDkzLjI1SDYxLjU0MDZDNjAuNDQ0OSA5My4yNSA1OS41NTc3IDkyLjM2MzcgNTkuNTU3NyA5MS4yNjhWODEuNjc4OUM1OS41NTc3IDc3LjkwMzEgNjEuNzkyMSA3NC40ODU1IDY1LjI0OTggNzIuOTcyOUM2OS44ODQ5IDcwLjk0NTQgNzUuMzY4MSA2OC4yMDI4IDc2LjM5OTQgNjIuNjk5MkM3Ni43MzIzIDYwLjkyMjkgNzUuNTc0MSA1OS4yMDk0IDczLjgwMjQgNTguODU3M0M2OS4zMjI2IDU3Ljk2NjcgNjQuMzU2MiA1OC4zMTA3IDYwLjE1NjQgNjAuMTg5M0M1NS4zODg3IDYyLjMyMTkgNTQuMTQxNSA2NS44Njk0IDUzLjY3OTcgNzAuNjMzN0w1My4xMjAxIDc1Ljc2NjJDNTIuOTQ5MSA3Ny4zMzQ5IDUxLjQ3ODUgNzguNTM2NiA0OS45MDE0IDc4LjUzNjZDNDguMjY5OSA3OC41MzY2IDQ3LjA0NjUgNzcuMjk0IDQ2Ljg2OTYgNzUuNjcxMkw0Ni4zMjA0IDcwLjYzMzdDNDUuOTI0OSA2Ni41NTI5IDQ1LjIwNzkgNjIuNTg4NyA0MC45ODk1IDYwLjcwMThDMzYuMTc3NiA1OC41NDk0IDMxLjM0MTkgNTcuODM0NyAyNi4xOTc2IDU4Ljg1NzNDMjQuNDI2IDU5LjIwOTQgMjMuMjY3OCA2MC45MjI5IDIzLjYwMDcgNjIuNjk5MkMyNC42NDEgNjguMjUwNyAzMC4wODEyIDcwLjkzMDUgMzQuNzUwMyA3Mi45NzI5QzM4LjIwOCA3NC40ODU1IDQwLjQ0MjQgNzcuOTAzMSA0MC40NDI0IDgxLjY3ODlWOTEuMjY2M0M0MC40NDI0IDkyLjM2MiAzOS41NTU1IDkzLjI1IDM4LjQ1OTkgOTMuMjVIMjcuMzc1NkMyMC43MDI0IDkzLjI1IDE0LjcwNTcgODcuODk5MSAxNC41ODkxIDgxLjIyMzNWNTMuODY2M0MxNC41ODkxIDUxLjI0NDYgMTYuMzA0NSA0OC45MzE2IDE4LjgxMzIgNDguMTcwN1oiCiAgICAgICAgZmlsbD0idXJsKCNwYWludDJfbGluZWFyXzM3Ml80MDI1OSkiIC8+CiAgICA8ZGVmcz4KICAgICAgICA8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50MF9saW5lYXJfMzcyXzQwMjU5IiB4MT0iNDkuMzA1NyIgeTE9IjIuMDc5IiB4Mj0iODAuMzYyNyIgeTI9IjkzLjY1OTciCiAgICAgICAgICAgIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KICAgICAgICAgICAgPHN0b3Agc3RvcC1jb2xvcj0iI0Y1RDQ1RSIgLz4KICAgICAgICAgICAgPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjRkY5NjAwIiAvPgogICAgICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICAgICAgPGxpbmVhckdyYWRpZW50IGlkPSJwYWludDFfbGluZWFyXzM3Ml80MDI1OSIgeDE9IjQ5LjMwNTciIHkxPSIyLjA3OSIgeDI9IjgwLjM2MjciIHkyPSI5My42NTk3IgogICAgICAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CiAgICAgICAgICAgIDxzdG9wIHN0b3AtY29sb3I9IiNGNUQ0NUUiIC8+CiAgICAgICAgICAgIDxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iI0ZGOTYwMCIgLz4KICAgICAgICA8L2xpbmVhckdyYWRpZW50PgogICAgICAgIDxsaW5lYXJHcmFkaWVudCBpZD0icGFpbnQyX2xpbmVhcl8zNzJfNDAyNTkiIHgxPSI0OS4zMDU3IiB5MT0iMi4wNzkiIHgyPSI4MC4zNjI3IiB5Mj0iOTMuNjU5NyIKICAgICAgICAgICAgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgogICAgICAgICAgICA8c3RvcCBzdG9wLWNvbG9yPSIjRjVENDVFIiAvPgogICAgICAgICAgICA8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNGRjk2MDAiIC8+CiAgICAgICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDwvZGVmcz4KPC9zdmc+",downloads:{chrome:"https://chrome.google.com/webstore/detail/braavos-wallet/jnlgamecbpmbajjfhmmmlhejkemejdma",firefox:"https://addons.mozilla.org/en-US/firefox/addon/braavos-wallet",edge:"https://microsoftedge.microsoft.com/addons/detail/braavos-wallet/hkkpjehhcnhgefhbdcgfkeegglpjchdc"}}],v=()=>`${Date.now()}-${Math.floor(Math.random()*(9e12-1))+1e12}`,k=e=>{for(let t=e.length-1;t>0;t--){const i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}return e};function C(...e){return t=>e.reduce((i,M)=>i.then(M),Promise.resolve(t))}var s,r,D,O,S,l,A;class W{constructor(t){N(this,O),N(this,l),N(this,s,!1),N(this,r,void 0),N(this,D,void 0),E(this,"value"),z(this,D,t),u(this,l,A).call(this)}set(t){return!o(this,s)&&!u(this,l,A).call(this)?!1:(this.delete(),this.value=t,t&&(z(this,r,`${o(this,D)}-${v()}`),localStorage.setItem(o(this,r),t)),!0)}get(){return u(this,O,S).call(this),this.value}delete(){return!o(this,s)&&!u(this,l,A).call(this)?!1:(this.value=null,o(this,r)&&localStorage.removeItem(o(this,r)),!0)}}s=new WeakMap,r=new WeakMap,D=new WeakMap,O=new WeakSet,S=function(){this.value&&this.set(this.value)},l=new WeakSet,A=function(){try{!o(this,s)&&typeof window<"u"&&(z(this,r,Object.keys(localStorage).find(e=>e.startsWith(o(this,D)))),z(this,s,!0),o(this,r)&&this.set(localStorage.getItem(o(this,r))))}catch(e){console.warn(e)}return o(this,s)};function w(e,t){var i,M;if((i=t?.include)!=null&&i.length){const a=new Set(t.include);return e.filter(n=>a.has(n.id))}if((M=t?.exclude)!=null&&M.length){const a=new Set(t.exclude);return e.filter(n=>!a.has(n.id))}return e}const T=async e=>{const t=await Promise.all(e.map(i=>i.isPreauthorized().catch(()=>!1)));return e.filter((i,M)=>t[M])},p=e=>{try{return e&&["request","isConnected","provider","enable","isPreauthorized","on","off","version","id","name","icon"].every(t=>t in e)}catch{}return!1};function d(e,t){return Object.values(Object.getOwnPropertyNames(e).reduce((i,M)=>{if(M.startsWith("starknet")){const a=e[M];t(a)&&!i[a.id]&&(i[a.id]=a)}return i},{}))}const y=(e,t)=>{if(t&&Array.isArray(t)){e.sort((M,a)=>t.indexOf(M.id)-t.indexOf(a.id));const i=e.length-t.length;return[...e.slice(i),...k(e.slice(0,i))]}else return k(e)},G=typeof window<"u"?window:{},Z={windowObject:G,isWalletObject:p,storageFactoryImplementation:e=>new W(e)};function x(e={}){const{storageFactoryImplementation:t,windowObject:i,isWalletObject:M}={...Z,...e},a=t("gsw-last");return{getAvailableWallets:async(n={})=>{const I=d(i,M);return C(g=>w(g,n),g=>y(g,n.sort))(I)},getPreAuthorizedWallets:async(n={})=>{const I=d(i,M);return C(g=>T(g),g=>w(g,n),g=>y(g,n.sort))(I)},getDiscoveryWallets:async(n={})=>C(I=>w(I,n),I=>y(I,n.sort))(f),getLastConnectedWallet:async()=>{const n=a.get(),I=d(i,M).find(m=>m.id===n),[g]=await T(I?[I]:[]);return g||(a.delete(),null)},enable:async(n,I)=>{if(await n.enable(I??{starknetVersion:"v5"}),!n.isConnected)throw new Error("Failed to connect to wallet");return a.set(n.id),n},disconnect:async({clearLastWallet:n}={})=>{n&&a.delete()}}}const P=x();class _ extends c.Connector{constructor({options:i}){super();h(this,"_wallet");h(this,"_options");this._options=i}available(){return this.ensureWallet(),this._wallet!==void 0}async ready(){return await this.ensureWallet(),this._wallet?await this._wallet.isPreauthorized():!1}async chainId(){if(this.ensureWallet(),!this._wallet)throw new c.ConnectorNotConnectedError;const i=await this._wallet.provider.getChainId();return BigInt(i)}async onAccountsChanged(i){let M;if(typeof i=="string"?M=i:M=i[0],M){const a=await this.chainId();this.emit("change",{account:M,chainId:a})}else this.emit("disconnect")}onNetworkChanged(i){switch(i){case"SN_MAIN":this.emit("change",{chainId:BigInt(j.constants.StarknetChainId.SN_MAIN)});break;case"SN_GOERLI":this.emit("change",{chainId:BigInt(j.constants.StarknetChainId.SN_GOERLI)});break;case"mainnet-alpha":this.emit("change",{chainId:BigInt(j.constants.StarknetChainId.SN_MAIN)});break;case"goerli-alpha":this.emit("change",{chainId:BigInt(j.constants.StarknetChainId.SN_GOERLI)});break;default:this.emit("change",{});break}}async connect(){if(await this.ensureWallet(),!this._wallet)throw new c.ConnectorNotFoundError;let i;try{i=await this._wallet.enable({starknetVersion:"v5"})}catch{throw new c.UserRejectedRequestError}if(!this._wallet.isConnected)throw new c.UserRejectedRequestError;if(!this._wallet.isConnected||!i)throw new c.UserRejectedRequestError;return this._wallet.on("accountsChanged",async M=>{await this.onAccountsChanged(M)}),this._wallet.on("networkChanged",M=>{this.onNetworkChanged(M)}),await this.onAccountsChanged(i),this._wallet.account}async disconnect(){if(await this.ensureWallet(),!this.available())throw new c.ConnectorNotFoundError;if(!this._wallet?.isConnected)throw new c.UserNotConnectedError}async account(){if(await this.ensureWallet(),!this._wallet)throw new c.ConnectorNotConnectedError;return this._wallet.account?this._wallet.account:null}get id(){return this._options.id}get name(){if(!this._wallet)throw new c.ConnectorNotConnectedError;return this._wallet.name}get icon(){if(!this._wallet)throw new c.ConnectorNotConnectedError;return this._wallet.icon}get wallet(){if(!this._wallet)throw new c.ConnectorNotConnectedError;return this._wallet}async ensureWallet(){const a=(await x().getAvailableWallets()).filter(n=>n.id===this._options.id)[0];a&&(this._wallet=a)}}exports.InjectedConnector=_;exports.Z=P;
