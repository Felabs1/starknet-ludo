var b = Object.defineProperty;
var Y = (e, t, i) => t in e ? b(e, t, { enumerable: !0, configurable: !0, writable: !0, value: i }) : e[t] = i;
var h = (e, t, i) => (Y(e, typeof t != "symbol" ? t + "" : t, i), i);
import { constants as j } from "starknet";
import { C as f, a as l, b as T, U as w, d as E } from "./connector-ca2f4153.js";
var v = Object.defineProperty, W = (e, t, i) => t in e ? v(e, t, { enumerable: !0, configurable: !0, writable: !0, value: i }) : e[t] = i, p = (e, t, i) => (W(e, typeof t != "symbol" ? t + "" : t, i), i), k = (e, t, i) => {
  if (!t.has(e))
    throw TypeError("Cannot " + i);
}, c = (e, t, i) => (k(e, t, "read from private field"), i ? i.call(e) : t.get(e)), o = (e, t, i) => {
  if (t.has(e))
    throw TypeError("Cannot add the same private member more than once");
  t instanceof WeakSet ? t.add(e) : t.set(e, i);
}, z = (e, t, i, M) => (k(e, t, "write to private field"), M ? M.call(e, i) : t.set(e, i), i), A = (e, t, i) => (k(e, t, "access private method"), i);
const G = [
  {
    id: "argentX",
    name: "Argent X",
    icon: "data:image/svg+xml;base64,Cjxzdmcgd2lkdGg9IjQwIiBoZWlnaHQ9IjM2IiB2aWV3Qm94PSIwIDAgNDAgMzYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik0yNC43NTgyIC0zLjk3MzY0ZS0wN0gxNC42MjM4QzE0LjI4NTEgLTMuOTczNjRlLTA3IDE0LjAxMzggMC4yODExNzggMTQuMDA2NCAwLjYzMDY4M0MxMy44MDE3IDEwLjQ1NDkgOC44MjIzNCAxOS43NzkyIDAuMjUxODkzIDI2LjM4MzdDLTAuMDIwMjA0NiAyNi41OTMzIC0wLjA4MjE5NDYgMjYuOTg3MiAwLjExNjczNCAyNy4yNzA5TDYuMDQ2MjMgMzUuNzM0QzYuMjQ3OTYgMzYuMDIyIDYuNjQwOTkgMzYuMDg3IDYuOTE3NjYgMzUuODc1NEMxMi4yNzY1IDMxLjc3MjggMTYuNTg2OSAyNi44MjM2IDE5LjY5MSAyMS4zMzhDMjIuNzk1MSAyNi44MjM2IDI3LjEwNTcgMzEuNzcyOCAzMi40NjQ2IDM1Ljg3NTRDMzIuNzQxIDM2LjA4NyAzMy4xMzQxIDM2LjAyMiAzMy4zMzYxIDM1LjczNEwzOS4yNjU2IDI3LjI3MDlDMzkuNDY0MiAyNi45ODcyIDM5LjQwMjIgMjYuNTkzMyAzOS4xMzA0IDI2LjM4MzdDMzAuNTU5NyAxOS43NzkyIDI1LjU4MDQgMTAuNDU0OSAyNS4zNzU5IDAuNjMwNjgzQzI1LjM2ODUgMC4yODExNzggMjUuMDk2OSAtMy45NzM2NGUtMDcgMjQuNzU4MiAtMy45NzM2NGUtMDdaIiBmaWxsPSIjRkY4NzVCIi8+Cjwvc3ZnPgo=",
    downloads: {
      chrome: "https://chrome.google.com/webstore/detail/argent-x-starknet-wallet/dlcobpjiigpikoobohmabehhmhfoodbb",
      firefox: "https://addons.mozilla.org/en-US/firefox/addon/argent-x"
    }
  },
  {
    id: "braavos",
    name: "Braavos",
    icon: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgICA8cGF0aAogICAgICAgIGQ9Ik02Mi43MDUgMTMuOTExNkM2Mi44MzU5IDE0LjEzMzMgNjIuNjYyMSAxNC40MDcgNjIuNDAzOSAxNC40MDdDNTcuMTgwNyAxNC40MDcgNTIuOTM0OCAxOC41NDI3IDUyLjgzNTEgMjMuNjgxN0M1MS4wNDY1IDIzLjM0NzcgNDkuMTkzMyAyMy4zMjI2IDQ3LjM2MjYgMjMuNjMxMUM0Ny4yMzYxIDE4LjUxNTYgNDMuMDAwOSAxNC40MDcgMzcuNzk0OCAxNC40MDdDMzcuNTM2NSAxNC40MDcgMzcuMzYyNSAxNC4xMzMxIDM3LjQ5MzUgMTMuOTExMkM0MC4wMjE3IDkuNjI4MDkgNDQuNzIwNCA2Ljc1IDUwLjA5OTEgNi43NUM1NS40NzgxIDYuNzUgNjAuMTc2OSA5LjYyODI2IDYyLjcwNSAxMy45MTE2WiIKICAgICAgICBmaWxsPSJ1cmwoI3BhaW50MF9saW5lYXJfMzcyXzQwMjU5KSIgLz4KICAgIDxwYXRoCiAgICAgICAgZD0iTTc4Ljc2MDYgNDUuODcxOEM4MC4yNzI1IDQ2LjMyOTcgODEuNzAyNSA0NS4wMDU1IDgxLjE3MTQgNDMuNTIyMkM3Ni40MTM3IDMwLjIzMzQgNjEuMzkxMSAyNC44MDM5IDUwLjAyNzcgMjQuODAzOUMzOC42NDQyIDI0LjgwMzkgMjMuMjg2OCAzMC40MDcgMTguODc1NCA0My41OTEyQzE4LjM4MjQgNDUuMDY0NSAxOS44MDgzIDQ2LjM0NDYgMjEuMjk3OCA0NS44ODgxTDQ4Ljg3MiAzNy40MzgxQzQ5LjUzMzEgMzcuMjM1NSA1MC4yMzk5IDM3LjIzNDQgNTAuOTAxNyAzNy40MzQ4TDc4Ljc2MDYgNDUuODcxOFoiCiAgICAgICAgZmlsbD0idXJsKCNwYWludDFfbGluZWFyXzM3Ml80MDI1OSkiIC8+CiAgICA8cGF0aAogICAgICAgIGQ9Ik0xOC44MTMyIDQ4LjE3MDdMNDguODkzNSAzOS4wNDcyQzQ5LjU1MDYgMzguODQ3OCA1MC4yNTI0IDM4Ljg0NzMgNTAuOTA5OCAzOS4wNDU2TDgxLjE3ODEgNDguMTc1MkM4My42OTEyIDQ4LjkzMzIgODUuNDExIDUxLjI0ODMgODUuNDExIDUzLjg3MzVWODEuMjIzM0M4NS4yOTQ0IDg3Ljg5OTEgNzkuMjk3NyA5My4yNSA3Mi42MjQ1IDkzLjI1SDYxLjU0MDZDNjAuNDQ0OSA5My4yNSA1OS41NTc3IDkyLjM2MzcgNTkuNTU3NyA5MS4yNjhWODEuNjc4OUM1OS41NTc3IDc3LjkwMzEgNjEuNzkyMSA3NC40ODU1IDY1LjI0OTggNzIuOTcyOUM2OS44ODQ5IDcwLjk0NTQgNzUuMzY4MSA2OC4yMDI4IDc2LjM5OTQgNjIuNjk5MkM3Ni43MzIzIDYwLjkyMjkgNzUuNTc0MSA1OS4yMDk0IDczLjgwMjQgNTguODU3M0M2OS4zMjI2IDU3Ljk2NjcgNjQuMzU2MiA1OC4zMTA3IDYwLjE1NjQgNjAuMTg5M0M1NS4zODg3IDYyLjMyMTkgNTQuMTQxNSA2NS44Njk0IDUzLjY3OTcgNzAuNjMzN0w1My4xMjAxIDc1Ljc2NjJDNTIuOTQ5MSA3Ny4zMzQ5IDUxLjQ3ODUgNzguNTM2NiA0OS45MDE0IDc4LjUzNjZDNDguMjY5OSA3OC41MzY2IDQ3LjA0NjUgNzcuMjk0IDQ2Ljg2OTYgNzUuNjcxMkw0Ni4zMjA0IDcwLjYzMzdDNDUuOTI0OSA2Ni41NTI5IDQ1LjIwNzkgNjIuNTg4NyA0MC45ODk1IDYwLjcwMThDMzYuMTc3NiA1OC41NDk0IDMxLjM0MTkgNTcuODM0NyAyNi4xOTc2IDU4Ljg1NzNDMjQuNDI2IDU5LjIwOTQgMjMuMjY3OCA2MC45MjI5IDIzLjYwMDcgNjIuNjk5MkMyNC42NDEgNjguMjUwNyAzMC4wODEyIDcwLjkzMDUgMzQuNzUwMyA3Mi45NzI5QzM4LjIwOCA3NC40ODU1IDQwLjQ0MjQgNzcuOTAzMSA0MC40NDI0IDgxLjY3ODlWOTEuMjY2M0M0MC40NDI0IDkyLjM2MiAzOS41NTU1IDkzLjI1IDM4LjQ1OTkgOTMuMjVIMjcuMzc1NkMyMC43MDI0IDkzLjI1IDE0LjcwNTcgODcuODk5MSAxNC41ODkxIDgxLjIyMzNWNTMuODY2M0MxNC41ODkxIDUxLjI0NDYgMTYuMzA0NSA0OC45MzE2IDE4LjgxMzIgNDguMTcwN1oiCiAgICAgICAgZmlsbD0idXJsKCNwYWludDJfbGluZWFyXzM3Ml80MDI1OSkiIC8+CiAgICA8ZGVmcz4KICAgICAgICA8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50MF9saW5lYXJfMzcyXzQwMjU5IiB4MT0iNDkuMzA1NyIgeTE9IjIuMDc5IiB4Mj0iODAuMzYyNyIgeTI9IjkzLjY1OTciCiAgICAgICAgICAgIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KICAgICAgICAgICAgPHN0b3Agc3RvcC1jb2xvcj0iI0Y1RDQ1RSIgLz4KICAgICAgICAgICAgPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjRkY5NjAwIiAvPgogICAgICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICAgICAgPGxpbmVhckdyYWRpZW50IGlkPSJwYWludDFfbGluZWFyXzM3Ml80MDI1OSIgeDE9IjQ5LjMwNTciIHkxPSIyLjA3OSIgeDI9IjgwLjM2MjciIHkyPSI5My42NTk3IgogICAgICAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CiAgICAgICAgICAgIDxzdG9wIHN0b3AtY29sb3I9IiNGNUQ0NUUiIC8+CiAgICAgICAgICAgIDxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iI0ZGOTYwMCIgLz4KICAgICAgICA8L2xpbmVhckdyYWRpZW50PgogICAgICAgIDxsaW5lYXJHcmFkaWVudCBpZD0icGFpbnQyX2xpbmVhcl8zNzJfNDAyNTkiIHgxPSI0OS4zMDU3IiB5MT0iMi4wNzkiIHgyPSI4MC4zNjI3IiB5Mj0iOTMuNjU5NyIKICAgICAgICAgICAgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgogICAgICAgICAgICA8c3RvcCBzdG9wLWNvbG9yPSIjRjVENDVFIiAvPgogICAgICAgICAgICA8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNGRjk2MDAiIC8+CiAgICAgICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDwvZGVmcz4KPC9zdmc+",
    downloads: {
      chrome: "https://chrome.google.com/webstore/detail/braavos-wallet/jnlgamecbpmbajjfhmmmlhejkemejdma",
      firefox: "https://addons.mozilla.org/en-US/firefox/addon/braavos-wallet",
      edge: "https://microsoftedge.microsoft.com/addons/detail/braavos-wallet/hkkpjehhcnhgefhbdcgfkeegglpjchdc"
    }
  }
], Z = () => `${Date.now()}-${Math.floor(Math.random() * (9e12 - 1)) + 1e12}`, S = (e) => {
  for (let t = e.length - 1; t > 0; t--) {
    const i = Math.floor(Math.random() * (t + 1));
    [e[t], e[i]] = [e[i], e[t]];
  }
  return e;
};
function C(...e) {
  return (t) => e.reduce((i, M) => i.then(M), Promise.resolve(t));
}
var s, N, D, L, m, r, u;
class P {
  constructor(t) {
    o(this, L), o(this, r), o(this, s, !1), o(this, N, void 0), o(this, D, void 0), p(this, "value"), z(this, D, t), A(this, r, u).call(this);
  }
  set(t) {
    return !c(this, s) && !A(this, r, u).call(this) ? !1 : (this.delete(), this.value = t, t && (z(this, N, `${c(this, D)}-${Z()}`), localStorage.setItem(c(this, N), t)), !0);
  }
  get() {
    return A(this, L, m).call(this), this.value;
  }
  delete() {
    return !c(this, s) && !A(this, r, u).call(this) ? !1 : (this.value = null, c(this, N) && localStorage.removeItem(c(this, N)), !0);
  }
}
s = /* @__PURE__ */ new WeakMap(), N = /* @__PURE__ */ new WeakMap(), D = /* @__PURE__ */ new WeakMap(), L = /* @__PURE__ */ new WeakSet(), m = function() {
  this.value && this.set(this.value);
}, r = /* @__PURE__ */ new WeakSet(), u = function() {
  try {
    !c(this, s) && typeof window < "u" && (z(this, N, Object.keys(localStorage).find(
      (e) => e.startsWith(c(this, D))
    )), z(this, s, !0), c(this, N) && this.set(localStorage.getItem(c(this, N))));
  } catch (e) {
    console.warn(e);
  }
  return c(this, s);
};
function d(e, t) {
  var i, M;
  if ((i = t?.include) != null && i.length) {
    const n = new Set(t.include);
    return e.filter((a) => n.has(a.id));
  }
  if ((M = t?.exclude) != null && M.length) {
    const n = new Set(t.exclude);
    return e.filter((a) => !n.has(a.id));
  }
  return e;
}
const x = async (e) => {
  const t = await Promise.all(
    e.map((i) => i.isPreauthorized().catch(() => !1))
  );
  return e.filter((i, M) => t[M]);
}, _ = (e) => {
  try {
    return e && [
      "request",
      "isConnected",
      "provider",
      "enable",
      "isPreauthorized",
      "on",
      "off",
      "version",
      "id",
      "name",
      "icon"
    ].every((t) => t in e);
  } catch {
  }
  return !1;
};
function y(e, t) {
  return Object.values(
    Object.getOwnPropertyNames(e).reduce((i, M) => {
      if (M.startsWith("starknet")) {
        const n = e[M];
        t(n) && !i[n.id] && (i[n.id] = n);
      }
      return i;
    }, {})
  );
}
const O = (e, t) => {
  if (t && Array.isArray(t)) {
    e.sort((M, n) => t.indexOf(M.id) - t.indexOf(n.id));
    const i = e.length - t.length;
    return [
      ...e.slice(i),
      ...S(e.slice(0, i))
    ];
  } else
    return S(e);
}, R = typeof window < "u" ? window : {}, V = {
  windowObject: R,
  isWalletObject: _,
  storageFactoryImplementation: (e) => new P(e)
};
function Q(e = {}) {
  const { storageFactoryImplementation: t, windowObject: i, isWalletObject: M } = {
    ...V,
    ...e
  }, n = t("gsw-last");
  return {
    getAvailableWallets: async (a = {}) => {
      const I = y(
        i,
        M
      );
      return C(
        (g) => d(g, a),
        (g) => O(g, a.sort)
      )(I);
    },
    getPreAuthorizedWallets: async (a = {}) => {
      const I = y(
        i,
        M
      );
      return C(
        (g) => x(g),
        (g) => d(g, a),
        (g) => O(g, a.sort)
      )(I);
    },
    getDiscoveryWallets: async (a = {}) => C(
      (I) => d(I, a),
      (I) => O(I, a.sort)
    )(G),
    getLastConnectedWallet: async () => {
      const a = n.get(), I = y(i, M).find(
        (U) => U.id === a
      ), [g] = await x(
        I ? [I] : []
      );
      return g || (n.delete(), null);
    },
    enable: async (a, I) => {
      if (await a.enable(I ?? { starknetVersion: "v5" }), !a.isConnected)
        throw new Error("Failed to connect to wallet");
      return n.set(a.id), a;
    },
    disconnect: async ({ clearLastWallet: a } = {}) => {
      a && n.delete();
    }
  };
}
const H = Q();
class J extends f {
  constructor({ options: i }) {
    super();
    h(this, "_wallet");
    h(this, "_options");
    this._options = i;
  }
  available() {
    return this.ensureWallet(), this._wallet !== void 0;
  }
  async ready() {
    return await this.ensureWallet(), this._wallet ? await this._wallet.isPreauthorized() : !1;
  }
  async chainId() {
    if (this.ensureWallet(), !this._wallet)
      throw new l();
    const i = await this._wallet.provider.getChainId();
    return BigInt(i);
  }
  async onAccountsChanged(i) {
    let M;
    if (typeof i == "string" ? M = i : M = i[0], M) {
      const n = await this.chainId();
      this.emit("change", { account: M, chainId: n });
    } else
      this.emit("disconnect");
  }
  onNetworkChanged(i) {
    switch (i) {
      case "SN_MAIN":
        this.emit("change", {
          chainId: BigInt(j.StarknetChainId.SN_MAIN)
        });
        break;
      case "SN_GOERLI":
        this.emit("change", {
          chainId: BigInt(j.StarknetChainId.SN_GOERLI)
        });
        break;
      case "mainnet-alpha":
        this.emit("change", {
          chainId: BigInt(j.StarknetChainId.SN_MAIN)
        });
        break;
      case "goerli-alpha":
        this.emit("change", {
          chainId: BigInt(j.StarknetChainId.SN_GOERLI)
        });
        break;
      default:
        this.emit("change", {});
        break;
    }
  }
  async connect() {
    if (await this.ensureWallet(), !this._wallet)
      throw new T();
    let i;
    try {
      i = await this._wallet.enable({ starknetVersion: "v5" });
    } catch {
      throw new w();
    }
    if (!this._wallet.isConnected)
      throw new w();
    if (!this._wallet.isConnected || !i)
      throw new w();
    return this._wallet.on("accountsChanged", async (M) => {
      await this.onAccountsChanged(M);
    }), this._wallet.on("networkChanged", (M) => {
      this.onNetworkChanged(M);
    }), await this.onAccountsChanged(i), this._wallet.account;
  }
  async disconnect() {
    if (await this.ensureWallet(), !this.available())
      throw new T();
    if (!this._wallet?.isConnected)
      throw new E();
  }
  async account() {
    if (await this.ensureWallet(), !this._wallet)
      throw new l();
    return this._wallet.account ? this._wallet.account : null;
  }
  get id() {
    return this._options.id;
  }
  get name() {
    if (!this._wallet)
      throw new l();
    return this._wallet.name;
  }
  get icon() {
    if (!this._wallet)
      throw new l();
    return this._wallet.icon;
  }
  get wallet() {
    if (!this._wallet)
      throw new l();
    return this._wallet;
  }
  async ensureWallet() {
    const n = (await Q().getAvailableWallets()).filter((a) => a.id === this._options.id)[0];
    n && (this._wallet = n);
  }
}
export {
  J as I,
  H as Z
};
